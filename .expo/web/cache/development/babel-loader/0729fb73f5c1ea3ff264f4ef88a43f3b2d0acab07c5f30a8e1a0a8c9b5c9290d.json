{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/dogaulku/Desktop/metusnew/Motus/src/contexts/SessionContext.tsx\",\n  _this = this;\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport { loadSessions, saveSessions } from \"../services/storage\";\nimport { v4 as uuid } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar SessionContext = createContext(undefined);\nexport var SessionProvider = function SessionProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    sessions = _useState2[0],\n    setSessions = _useState2[1];\n  var _useState3 = useState(),\n    _useState4 = _slicedToArray(_useState3, 2),\n    activeSessionId = _useState4[0],\n    setActiveSessionId = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var data = yield loadSessions();\n      setSessions(data);\n      setLoading(false);\n    })();\n  }, []);\n  useEffect(function () {\n    if (!loading) {\n      saveSessions(sessions);\n    }\n  }, [sessions, loading]);\n  var activeSession = useMemo(function () {\n    return sessions.find(function (session) {\n      return session.id === activeSessionId;\n    });\n  }, [sessions, activeSessionId]);\n  var startSession = function startSession(locale) {\n    var session = {\n      id: uuid(),\n      createdAt: Date.now(),\n      locale: locale,\n      photos: []\n    };\n    setSessions(function (prev) {\n      return [session].concat(_toConsumableArray(prev));\n    });\n    setActiveSessionId(session.id);\n    return session;\n  };\n  var setActiveSession = function setActiveSession(id) {\n    setActiveSessionId(id);\n  };\n  var appendPhoto = function appendPhoto(angleId, base64, uri) {\n    if (!activeSessionId) {\n      return;\n    }\n    setSessions(function (prev) {\n      return prev.map(function (session) {\n        return session.id === activeSessionId ? _objectSpread(_objectSpread({}, session), {}, {\n          photos: [].concat(_toConsumableArray(session.photos.filter(function (photo) {\n            return photo.angleId !== angleId;\n          })), [{\n            angleId: angleId,\n            base64: base64,\n            timestamp: Date.now(),\n            uri: uri\n          }])\n        }) : session;\n      });\n    });\n  };\n  var completeSession = function completeSession(estimate) {\n    if (!activeSessionId) {\n      return;\n    }\n    setSessions(function (prev) {\n      return prev.map(function (session) {\n        return session.id === activeSessionId ? _objectSpread(_objectSpread({}, session), {}, {\n          graftEstimation: estimate != null ? estimate : session.graftEstimation\n        }) : session;\n      });\n    });\n    setActiveSessionId(undefined);\n  };\n  var updateSessionEstimate = function updateSessionEstimate(sessionId, estimate) {\n    setSessions(function (prev) {\n      return prev.map(function (session) {\n        return session.id === sessionId ? _objectSpread(_objectSpread({}, session), {}, {\n          graftEstimation: estimate\n        }) : session;\n      });\n    });\n  };\n  var value = useMemo(function () {\n    return {\n      sessions: sessions,\n      activeSession: activeSession,\n      startSession: startSession,\n      appendPhoto: appendPhoto,\n      completeSession: completeSession,\n      setActiveSession: setActiveSession,\n      updateSessionEstimate: updateSessionEstimate,\n      loading: loading\n    };\n  }, [sessions, activeSession, loading]);\n  return _jsxDEV(SessionContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 10\n  }, _this);\n};\nexport var useSessions = function useSessions() {\n  var context = useContext(SessionContext);\n  if (!context) {\n    throw new Error('useSessions must be used within SessionProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useState","loadSessions","saveSessions","v4","uuid","jsxDEV","_jsxDEV","SessionContext","undefined","SessionProvider","_ref","children","_useState","_useState2","_slicedToArray","sessions","setSessions","_useState3","_useState4","activeSessionId","setActiveSessionId","_useState5","_useState6","loading","setLoading","_asyncToGenerator","data","activeSession","find","session","id","startSession","locale","createdAt","Date","now","photos","prev","concat","_toConsumableArray","setActiveSession","appendPhoto","angleId","base64","uri","map","_objectSpread","filter","photo","timestamp","completeSession","estimate","graftEstimation","updateSessionEstimate","sessionId","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_this","useSessions","context","Error"],"sources":["/Users/dogaulku/Desktop/metusnew/Motus/src/contexts/SessionContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport { CaptureSession, AngleId, CapturedPhoto, GraftEstimationResult } from '@types';\nimport { loadSessions, saveSessions } from '@services/storage';\nimport { v4 as uuid } from 'uuid';\n\ninterface SessionContextValue {\n  sessions: CaptureSession[];\n  activeSession?: CaptureSession;\n  startSession: (locale: string) => CaptureSession;\n  appendPhoto: (angleId: AngleId, base64: string, uri?: string) => void;\n  completeSession: (estimate?: GraftEstimationResult) => void;\n  setActiveSession: (id?: string) => void;\n  updateSessionEstimate: (sessionId: string, estimate: GraftEstimationResult) => void;\n  loading: boolean;\n}\n\nconst SessionContext = createContext<SessionContextValue | undefined>(undefined);\n\nexport const SessionProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [sessions, setSessions] = useState<CaptureSession[]>([]);\n  const [activeSessionId, setActiveSessionId] = useState<string | undefined>();\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    (async () => {\n      const data = await loadSessions();\n      setSessions(data);\n      setLoading(false);\n    })();\n  }, []);\n\n  useEffect(() => {\n    if (!loading) {\n      saveSessions(sessions);\n    }\n  }, [sessions, loading]);\n\n  const activeSession = useMemo(\n    () => sessions.find((session) => session.id === activeSessionId),\n    [sessions, activeSessionId]\n  );\n\n  const startSession = (locale: string): CaptureSession => {\n    const session: CaptureSession = {\n      id: uuid(),\n      createdAt: Date.now(),\n      locale,\n      photos: []\n    };\n    setSessions((prev) => [session, ...prev]);\n    setActiveSessionId(session.id);\n    return session;\n  };\n\n  const setActiveSession = (id?: string) => {\n    setActiveSessionId(id);\n  };\n\n  const appendPhoto = (angleId: AngleId, base64: string, uri?: string) => {\n    if (!activeSessionId) {\n      return;\n    }\n    setSessions((prev) =>\n      prev.map((session) =>\n        session.id === activeSessionId\n          ? {\n              ...session,\n              photos: [\n                ...session.photos.filter((photo) => photo.angleId !== angleId),\n                { angleId, base64, timestamp: Date.now(), uri }\n              ]\n            }\n          : session\n      )\n    );\n  };\n\n  const completeSession = (estimate?: GraftEstimationResult) => {\n    if (!activeSessionId) {\n      return;\n    }\n    setSessions((prev) =>\n      prev.map((session) =>\n        session.id === activeSessionId\n          ? {\n              ...session,\n              graftEstimation: estimate ?? session.graftEstimation\n            }\n          : session\n      )\n    );\n    setActiveSessionId(undefined);\n  };\n\n  const updateSessionEstimate = (sessionId: string, estimate: GraftEstimationResult) => {\n    setSessions((prev) =>\n      prev.map((session) => (session.id === sessionId ? { ...session, graftEstimation: estimate } : session))\n    );\n  };\n\n  const value = useMemo(\n    () => ({\n      sessions,\n      activeSession,\n      startSession,\n      appendPhoto,\n      completeSession,\n      setActiveSession,\n      updateSessionEstimate,\n      loading\n    }),\n    [sessions, activeSession, loading]\n  );\n\n  return <SessionContext.Provider value={value}>{children}</SessionContext.Provider>;\n};\n\nexport const useSessions = () => {\n  const context = useContext(SessionContext);\n  if (!context) {\n    throw new Error('useSessions must be used within SessionProvider');\n  }\n  return context;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}